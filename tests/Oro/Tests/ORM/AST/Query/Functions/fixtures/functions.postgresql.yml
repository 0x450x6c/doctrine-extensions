- type: "datetime"
  name: "timestamp"
  className: "Oro\\ORM\\Query\\AST\\Functions\\SimpleFunction"
  dql: "SELECT TIMESTAMP(f.createdAt) FROM Oro\\Entities\\Foo f WHERE f.id = 1"
  sql: 'SELECT "timestamp"(t0_.created_at) AS sclr0 FROM test_foo t0_ WHERE t0_.id = 1'
  expectedResult:
      - "2014-01-04 05:06:07"

- type: "datetime"
  name: "timestamp"
  className: "Oro\\ORM\\Query\\AST\\Functions\\SimpleFunction"
  dql: "SELECT TIMESTAMP('2014-01-04 05:06:07') FROM Oro\\Entities\\Foo f WHERE f.id = 1"
  sql: SELECT "timestamp"('2014-01-04 05:06:07') AS sclr0 FROM test_foo t0_ WHERE t0_.id = 1
  expectedResult:
      - "2014-01-04 05:06:07"

- type: "datetime"
  name: "date"
  className: "Oro\\ORM\\Query\\AST\\Functions\\SimpleFunction"
  dql: "SELECT DATE(f.createdAt) FROM Oro\\Entities\\Foo f WHERE f.id = 1"
  sql: "SELECT DATE(t0_.created_at) AS sclr0 FROM test_foo t0_ WHERE t0_.id = 1"
  expectedResult:
      - "2014-01-04"

- type: "datetime"
  name: "date"
  className: "Oro\\ORM\\Query\\AST\\Functions\\SimpleFunction"
  dql: "SELECT DATE('2014-01-04 12:11:13') FROM Oro\\Entities\\Foo f WHERE f.id = 1"
  sql: "SELECT DATE('2014-01-04 12:11:13') AS sclr0 FROM test_foo t0_ WHERE t0_.id = 1"
  expectedResult:
      - "2014-01-04"

- type: "datetime"
  name: "convert_tz"
  className: "Oro\\ORM\\Query\\AST\\Functions\\DateTime\\ConvertTz"
  dql: "SELECT CONVERT_TZ(f.createdAt, '+00:00', '+01:00') FROM Oro\\Entities\\Foo f WHERE f.id = 1"
  sql: SELECT "timestamp"(t0_.created_at) AT TIME ZONE '+01:00' AT TIME ZONE '+00:00' AS sclr0 FROM test_foo t0_ WHERE t0_.id = 1
  expectedResult:
      - "2014-01-04 06:06:07"

- type: "datetime"
  name: "convert_tz"
  className: "Oro\\ORM\\Query\\AST\\Functions\\DateTime\\ConvertTz"
  dql: "SELECT CONVERT_TZ('2014-01-01 00:00:00', '+00:00', '+01:00') FROM Oro\\Entities\\Foo f WHERE f.id = 1"
  sql: SELECT "timestamp"('2014-01-01 00:00:00') AT TIME ZONE '+01:00' AT TIME ZONE '+00:00' AS sclr0 FROM test_foo t0_ WHERE t0_.id = 1
  expectedResult:
      - "2014-01-01 01:00:00"

- type: "datetime"
  name: "convert_tz"
  className: "Oro\\ORM\\Query\\AST\\Functions\\DateTime\\ConvertTz"
  dql: "SELECT CONVERT_TZ('2014-01-01 00:00:00', '+02:00', '+02:00') FROM Oro\\Entities\\Foo f WHERE f.id = 1"
  sql: SELECT "timestamp"('2014-01-01 00:00:00') AT TIME ZONE '+02:00' AT TIME ZONE '+02:00' AS sclr0 FROM test_foo t0_ WHERE t0_.id = 1
  expectedResult:
      - "2014-01-01 00:00:00"

- type: "datetime"
  name: "convert_tz"
  className: "Oro\\ORM\\Query\\AST\\Functions\\DateTime\\ConvertTz"
  dql: "SELECT CONVERT_TZ('2014-01-01 00:00:00', '+01:00', '+03:00') FROM Oro\\Entities\\Foo f WHERE f.id = 1"
  sql: SELECT "timestamp"('2014-01-01 00:00:00') AT TIME ZONE '+03:00' AT TIME ZONE '+01:00' AS sclr0 FROM test_foo t0_ WHERE t0_.id = 1
  expectedResult:
      - "2014-01-01 02:00:00"

- type: "numeric"
  name: "timestampdiff"
  className: "Oro\\ORM\\Query\\AST\\Functions\\Numeric\\TimestampDiff"
  dql: "SELECT TIMESTAMPDIFF(MICROSECOND, '2014-01-01 00:00:00', '2014-01-01 00:00:10.100') FROM Oro\\Entities\\Foo f WHERE f.id = 1"
  sql: SELECT CAST(ROUND((EXTRACT(EPOCH FROM "timestamp"('2014-01-01 00:00:10.100')) - EXTRACT(EPOCH FROM "timestamp"('2014-01-01 00:00:00'))) * 1000000) AS INT) AS sclr0 FROM test_foo t0_ WHERE t0_.id = 1
  expectedResult:
      - 10100000

- type: "numeric"
  name: "timestampdiff"
  className: "Oro\\ORM\\Query\\AST\\Functions\\Numeric\\TimestampDiff"
  dql: "SELECT TIMESTAMPDIFF(SECOND, '2014-01-01 00:00:00', '2014-01-01 00:00:10') FROM Oro\\Entities\\Foo f WHERE f.id = 1"
  sql: SELECT CAST(ROUND((EXTRACT(EPOCH FROM "timestamp"('2014-01-01 00:00:10')) - EXTRACT(EPOCH FROM "timestamp"('2014-01-01 00:00:00')))) AS INT) AS sclr0 FROM test_foo t0_ WHERE t0_.id = 1
  expectedResult:
      - 10

- type: "numeric"
  name: "timestampdiff"
  className: "Oro\\ORM\\Query\\AST\\Functions\\Numeric\\TimestampDiff"
  dql: "SELECT TIMESTAMPDIFF(MINUTE, '2014-01-01 00:00:00', '2014-01-01 00:10:10') FROM Oro\\Entities\\Foo f WHERE f.id = 1"
  sql: SELECT CAST(ROUND((EXTRACT(EPOCH FROM "timestamp"('2014-01-01 00:10:10')) - EXTRACT(EPOCH FROM "timestamp"('2014-01-01 00:00:00'))) / 60) AS INT) AS sclr0 FROM test_foo t0_ WHERE t0_.id = 1
  expectedResult:
      - 10

- type: "numeric"
  name: "timestampdiff"
  className: "Oro\\ORM\\Query\\AST\\Functions\\Numeric\\TimestampDiff"
  dql: "SELECT TIMESTAMPDIFF(HOUR, '2014-01-01 00:00:00', '2014-01-01 10:10:10') FROM Oro\\Entities\\Foo f WHERE f.id = 1"
  sql: SELECT CAST(ROUND((EXTRACT(EPOCH FROM "timestamp"('2014-01-01 10:10:10')) - EXTRACT(EPOCH FROM "timestamp"('2014-01-01 00:00:00'))) / 3600) AS INT) AS sclr0 FROM test_foo t0_ WHERE t0_.id = 1
  expectedResult:
      - 10

- type: "numeric"
  name: "timestampdiff"
  className: "Oro\\ORM\\Query\\AST\\Functions\\Numeric\\TimestampDiff"
  dql: "SELECT TIMESTAMPDIFF(DAY, '2014-01-01 00:00:00', '2014-01-11 10:10:10') FROM Oro\\Entities\\Foo f WHERE f.id = 1"
  sql: SELECT CAST(ROUND(EXTRACT(DAY FROM "timestamp"('2014-01-11 10:10:10') - "timestamp"('2014-01-01 00:00:00'))) AS INT) AS sclr0 FROM test_foo t0_ WHERE t0_.id = 1
  expectedResult:
      - 10

- type: "numeric"
  name: "timestampdiff"
  className: "Oro\\ORM\\Query\\AST\\Functions\\Numeric\\TimestampDiff"
  dql: "SELECT TIMESTAMPDIFF(WEEK, '2014-01-01 00:00:00', '2014-03-15 10:10:10') FROM Oro\\Entities\\Foo f WHERE f.id = 1"
  sql: SELECT CAST(ROUND(EXTRACT(DAY FROM "timestamp"('2014-03-15 10:10:10') - "timestamp"('2014-01-01 00:00:00')) / 7) AS INT) AS sclr0 FROM test_foo t0_ WHERE t0_.id = 1
  expectedResult:
      - 10

- type: "numeric"
  name: "timestampdiff"
  className: "Oro\\ORM\\Query\\AST\\Functions\\Numeric\\TimestampDiff"
  dql: "SELECT TIMESTAMPDIFF(MONTH, '2014-01-01 00:00:00', '2014-03-15 10:10:10') FROM Oro\\Entities\\Foo f WHERE f.id = 1"
  sql: SELECT CAST(ROUND((EXTRACT(YEAR FROM "timestamp"('2014-03-15 10:10:10')) - EXTRACT(YEAR FROM "timestamp"('2014-01-01 00:00:00'))) * 12 + (EXTRACT(MONTH FROM "timestamp"('2014-03-15 10:10:10')) - EXTRACT(MONTH FROM "timestamp"('2014-01-01 00:00:00')))) AS INT) AS sclr0 FROM test_foo t0_ WHERE t0_.id = 1
  expectedResult:
      - 2

- type: "numeric"
  name: "timestampdiff"
  className: "Oro\\ORM\\Query\\AST\\Functions\\Numeric\\TimestampDiff"
  dql: "SELECT TIMESTAMPDIFF(QUARTER, '2014-01-01 00:00:00', '2015-04-15 10:10:10') FROM Oro\\Entities\\Foo f WHERE f.id = 1"
  sql: SELECT CAST(ROUND((EXTRACT(YEAR FROM "timestamp"('2015-04-15 10:10:10')) - EXTRACT(YEAR FROM "timestamp"('2014-01-01 00:00:00'))) * 4 + (EXTRACT(QUARTER FROM "timestamp"('2015-04-15 10:10:10')) - EXTRACT(QUARTER FROM "timestamp"('2014-01-01 00:00:00')))) AS INT) AS sclr0 FROM test_foo t0_ WHERE t0_.id = 1
  expectedResult:
      - 5

- type: "numeric"
  name: "timestampdiff"
  className: "Oro\\ORM\\Query\\AST\\Functions\\Numeric\\TimestampDiff"
  dql: "SELECT TIMESTAMPDIFF(YEAR, '2014-01-01 00:00:00', '2015-04-15 10:10:10') FROM Oro\\Entities\\Foo f WHERE f.id = 1"
  sql: SELECT CAST(ROUND((EXTRACT(YEAR FROM "timestamp"('2015-04-15 10:10:10')) - EXTRACT(YEAR FROM "timestamp"('2014-01-01 00:00:00')))) AS INT) AS sclr0 FROM test_foo t0_ WHERE t0_.id = 1
  expectedResult:
      - 1

- type: "numeric"
  name: "day"
  className: "Oro\\ORM\\Query\\AST\\Functions\\SimpleFunction"
  dql: "SELECT DAY(f.createdAt) FROM Oro\\Entities\\Foo f WHERE f.id = 1"
  sql: "SELECT EXTRACT(DAY FROM t0_.created_at) AS sclr0 FROM test_foo t0_ WHERE t0_.id = 1"
  expectedResult:
      - 4

- type: "numeric"
  name: "day"
  className: "Oro\\ORM\\Query\\AST\\Functions\\SimpleFunction"
  dql: "SELECT DAY('2014-01-04 12:11:13') FROM Oro\\Entities\\Foo f WHERE f.id = 1"
  sql: SELECT EXTRACT(DAY FROM "timestamp"('2014-01-04 12:11:13')) AS sclr0 FROM test_foo t0_ WHERE t0_.id = 1
  expectedResult:
      - 4

- type: "numeric"
  name: "dayofyear"
  className: "Oro\\ORM\\Query\\AST\\Functions\\SimpleFunction"
  dql: "SELECT DAYOFYEAR(f.createdAt) FROM Oro\\Entities\\Foo f WHERE f.id = 1"
  sql: "SELECT EXTRACT(DOY FROM t0_.created_at) AS sclr0 FROM test_foo t0_ WHERE t0_.id = 1"
  expectedResult:
      - 4

- type: "numeric"
  name: "dayofweek"
  className: "Oro\\ORM\\Query\\AST\\Functions\\SimpleFunction"
  dql: "SELECT DAYOFWEEK(f.createdAt) FROM Oro\\Entities\\Foo f WHERE f.id = 1"
  sql: SELECT EXTRACT(DOW FROM t0_.created_at) + 1 AS sclr0 FROM test_foo t0_ WHERE t0_.id = 1
  expectedResult:
      - 7

- type: "numeric"
  name: "dayofweek"
  className: "Oro\\ORM\\Query\\AST\\Functions\\SimpleFunction"
  dql: "SELECT DAYOFWEEK('2014-01-03') FROM Oro\\Entities\\Foo f WHERE f.id = 1"
  sql: SELECT EXTRACT(DOW FROM "timestamp"('2014-01-03')) + 1 AS sclr0 FROM test_foo t0_ WHERE t0_.id = 1
  expectedResult:
      - 6

- type: "numeric"
  name: "hour"
  className: "Oro\\ORM\\Query\\AST\\Functions\\SimpleFunction"
  dql: "SELECT HOUR(f.createdAt) FROM Oro\\Entities\\Foo f WHERE f.id = 1"
  sql: "SELECT EXTRACT(HOUR FROM t0_.created_at) AS sclr0 FROM test_foo t0_ WHERE t0_.id = 1"
  expectedResult:
      - 5

- type: "numeric"
  name: "minute"
  className: "Oro\\ORM\\Query\\AST\\Functions\\SimpleFunction"
  dql: "SELECT MINUTE(f.createdAt) FROM Oro\\Entities\\Foo f WHERE f.id = 1"
  sql: "SELECT EXTRACT(MINUTE FROM t0_.created_at) AS sclr0 FROM test_foo t0_ WHERE t0_.id = 1"
  expectedResult:
      - 6

- type: "numeric"
  name: "month"
  className: "Oro\\ORM\\Query\\AST\\Functions\\SimpleFunction"
  dql: "SELECT MONTH(f.createdAt) FROM Oro\\Entities\\Foo f WHERE f.id = 1"
  sql: "SELECT EXTRACT(MONTH FROM t0_.created_at) AS sclr0 FROM test_foo t0_ WHERE t0_.id = 1"
  expectedResult:
      - 1

- type: "numeric"
  name: "quarter"
  className: "Oro\\ORM\\Query\\AST\\Functions\\SimpleFunction"
  dql: "SELECT QUARTER(f.createdAt) FROM Oro\\Entities\\Foo f WHERE f.id = 1"
  sql: "SELECT EXTRACT(QUARTER FROM t0_.created_at) AS sclr0 FROM test_foo t0_ WHERE t0_.id = 1"
  expectedResult:
      - 1

- type: "numeric"
  name: "second"
  className: "Oro\\ORM\\Query\\AST\\Functions\\SimpleFunction"
  dql: "SELECT SECOND(f.createdAt) FROM Oro\\Entities\\Foo f WHERE f.id = 1"
  sql: "SELECT EXTRACT(SECOND FROM t0_.created_at) AS sclr0 FROM test_foo t0_ WHERE t0_.id = 1"
  expectedResult:
      - 7

- type: "numeric"
  name: "week"
  className: "Oro\\ORM\\Query\\AST\\Functions\\SimpleFunction"
  dql: "SELECT WEEK(f.createdAt) FROM Oro\\Entities\\Foo f WHERE f.id = 1"
  sql: "SELECT EXTRACT(WEEK FROM t0_.created_at) AS sclr0 FROM test_foo t0_ WHERE t0_.id = 1"
  expectedResult:
      - 1

- type: "numeric"
  name: "year"
  className: "Oro\\ORM\\Query\\AST\\Functions\\SimpleFunction"
  dql: "SELECT YEAR(f.createdAt) FROM Oro\\Entities\\Foo f WHERE f.id = 1"
  sql: "SELECT EXTRACT(YEAR FROM t0_.created_at) AS sclr0 FROM test_foo t0_ WHERE t0_.id = 1"
  expectedResult:
      - 2014

- type: "string"
  name: "group_concat"
  className: "Oro\\ORM\\Query\\AST\\Functions\\String\\GroupConcat"
  dql: "SELECT GROUP_CONCAT(DISTINCT f.id ORDER BY f.id DESC SEPARATOR ':') FROM Oro\\Entities\\Foo f GROUP BY f.code"
  sql: "SELECT array_to_string(array_agg(DISTINCT t0_.id  ORDER BY t0_.id DESC), ':') AS sclr0 FROM test_foo t0_ GROUP BY t0_.code"
  expectedResult:
      - "2:1"

- type: "string"
  name: "group_concat"
  className: "Oro\\ORM\\Query\\AST\\Functions\\String\\GroupConcat"
  dql: "SELECT GROUP_CONCAT(f.id) FROM Oro\\Entities\\Foo f GROUP BY f.code"
  sql: "SELECT array_to_string(array_agg(t0_.id), ',') AS sclr0 FROM test_foo t0_ GROUP BY t0_.code"
  expectedResult:
      - "1,2"

- type: "numeric"
  name: "pow"
  className: "Oro\\ORM\\Query\\AST\\Functions\\Numeric\\Pow"
  dql: "SELECT POW(3, 2) FROM Oro\\Entities\\Foo f WHERE f.id = 1"
  sql: "SELECT POW(3, 2) AS sclr0 FROM test_foo t0_ WHERE t0_.id = 1"
  expectedResult:
      - 9

- type: "numeric"
  name: "pow"
  className: "Oro\\ORM\\Query\\AST\\Functions\\Numeric\\Pow"
  dql: "SELECT POW(-3, 2) FROM Oro\\Entities\\Foo f WHERE f.id = 1"
  sql: "SELECT POW(-3, 2) AS sclr0 FROM test_foo t0_ WHERE t0_.id = 1"
  expectedResult:
      - 9

- type: "numeric"
  name: "pow"
  className: "Oro\\ORM\\Query\\AST\\Functions\\Numeric\\Pow"
  dql: "SELECT POW(f.budget, 2) FROM Oro\\Entities\\Foo f WHERE f.id = 1"
  sql: "SELECT POW(t0_.budget, 2) AS sclr0 FROM test_foo t0_ WHERE t0_.id = 1"
  expectedResult:
      - 10000

- type: "numeric"
  name: "sign"
  className: "Oro\\ORM\\Query\\AST\\Functions\\Numeric\\Sign"
  dql: "SELECT SIGN(f.budget) FROM Oro\\Entities\\Foo f WHERE f.id = 1"
  sql: "SELECT SIGN(t0_.budget) AS sclr0 FROM test_foo t0_ WHERE t0_.id = 1"
  expectedResult:
      - 1

- type: "numeric"
  name: "sign"
  className: "Oro\\ORM\\Query\\AST\\Functions\\Numeric\\Sign"
  dql: "SELECT SIGN(-12) FROM Oro\\Entities\\Foo f WHERE f.id = 1"
  sql: "SELECT SIGN(-12) AS sclr0 FROM test_foo t0_ WHERE t0_.id = 1"
  expectedResult:
      - -1

# CAST function test

- type: "numeric"
  name: "cast"
  className: "Oro\\ORM\\Query\\AST\\Functions\\Cast"
  dql: "SELECT CAST(12 as int) FROM Oro\\Entities\\Foo f WHERE f.id = 1"
  sql: "SELECT CAST(12 AS int) AS sclr0 FROM test_foo t0_ WHERE t0_.id = 1"
  expectedResult:
      - 12

- type: "numeric"
  name: "cast"
  className: "Oro\\ORM\\Query\\AST\\Functions\\Cast"
  dql: "SELECT CAST('12' as int) FROM Oro\\Entities\\Foo f WHERE f.id = 1"
  sql: "SELECT CAST('12' AS int) AS sclr0 FROM test_foo t0_ WHERE t0_.id = 1"
  expectedResult:
      - 12

- type: "numeric"
  name: "cast"
  className: "Oro\\ORM\\Query\\AST\\Functions\\Cast"
  dql: "SELECT CAST('123' as integer) FROM Oro\\Entities\\Foo f WHERE f.id = 1"
  sql: "SELECT CAST('123' AS integer) AS sclr0 FROM test_foo t0_ WHERE t0_.id = 1"
  sql: "SELECT CAST('123' AS integer) AS sclr0 FROM test_foo t0_ WHERE t0_.id = 1"
  expectedResult:
      - 123

- type: "numeric"
  name: "cast"
  className: "Oro\\ORM\\Query\\AST\\Functions\\Cast"
  dql: "SELECT CAST('12' as char) FROM Oro\\Entities\\Foo f WHERE f.id = 1"
  sql: "SELECT CAST('12' AS char) AS sclr0 FROM test_foo t0_ WHERE t0_.id = 1"
  expectedResult:
      - 1

- type: "numeric"
  name: "cast"
  className: "Oro\\ORM\\Query\\AST\\Functions\\Cast"
  dql: "SELECT CAST('123' as decimal) FROM Oro\\Entities\\Foo f WHERE f.id = 1"
  sql: "SELECT CAST('123' AS decimal) AS sclr0 FROM test_foo t0_ WHERE t0_.id = 1"
  expectedResult:
      - 123

- type: "numeric"
  name: "cast"
  className: "Oro\\ORM\\Query\\AST\\Functions\\Cast"
  dql: "SELECT CAST('2014-01-02 12:13:14' as date) FROM Oro\\Entities\\Foo f WHERE f.id = 1"
  sql: "SELECT CAST('2014-01-02 12:13:14' AS date) AS sclr0 FROM test_foo t0_ WHERE t0_.id = 1"
  expectedResult:
      - '2014-01-02'

- type: "numeric"
  name: "cast"
  className: "Oro\\ORM\\Query\\AST\\Functions\\Cast"
  dql: "SELECT CAST('2014-01-02 12:13:14' as time) FROM Oro\\Entities\\Foo f WHERE f.id = 1"
  sql: "SELECT CAST('2014-01-02 12:13:14' AS time) AS sclr0 FROM test_foo t0_ WHERE t0_.id = 1"
  expectedResult:
      - '12:13:14'

- type: "numeric"
  name: "cast"
  className: "Oro\\ORM\\Query\\AST\\Functions\\Cast"
  dql: "SELECT CAST('2014-01-02 12:13:14' as datetime) FROM Oro\\Entities\\Foo f WHERE f.id = 1"
  sql: SELECT "timestamp"('2014-01-02 12:13:14') AS sclr0 FROM test_foo t0_ WHERE t0_.id = 1
  expectedResult:
      - '2014-01-02 12:13:14'

- type: "numeric"
  name: "cast"
  className: "Oro\\ORM\\Query\\AST\\Functions\\Cast"
  dql: "SELECT CAST(f.createdAt as datetime) FROM Oro\\Entities\\Foo f WHERE f.id = 1"
  sql: SELECT "timestamp"(t0_.created_at) AS sclr0 FROM test_foo t0_ WHERE t0_.id = 1
  expectedResult:
      - '2014-01-04 05:06:07'

- type: "numeric"
  name: "cast"
  className: "Oro\\ORM\\Query\\AST\\Functions\\Cast"
  dql: "SELECT CAST(f.createdAt as char) FROM Oro\\Entities\\Foo f WHERE f.id = 1"
  sql: "SELECT CAST(t0_.created_at AS char) AS sclr0 FROM test_foo t0_ WHERE t0_.id = 1"
  expectedResult:
      - '2'
